#!/usr/bin/env perl

use common::sense;
use autodie ':all';

use File::Spec::Functions 'splitdir', 'catfile', 'catdir', 'curdir';
use File::Path 'make_path';

my $in  = $ARGV[1] or die;
my $out = $ARGV[3] or die;

my $object = do {
   my @dir = splitdir $out;
   my $file = pop @dir;
   my $libsdir = catdir curdir, @dir, ".libs";

   $file =~ s/\.lo$/.o/;
   make_path $libsdir;
   
   $ARGV[3] = catfile $libsdir, $file;

   catdir ".libs", $file;
};

system @ARGV;

open my $fh, '>', $out;
print $fh <<EOF
# $out - a libtool object file
# Generated by ltmain.sh (GNU libtool) 2.2.6b Debian-2.2.6b-2
#
# Please DO NOT delete this file!
# It is necessary for linking the library.

# Name of the PIC object.
pic_object='$object'

# Name of the non-PIC object
non_pic_object=none
EOF
